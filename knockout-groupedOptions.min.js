/*!
 * knockout-groupedOptions.js v0.2
 * 
 * Copyright (c) Andrew Jameson, www.Supertext.ch
 * Available under the MIT license: http://opensource.org/licenses/MIT
 */
ko.bindingHandlers.groupedOptions={init:function(n,t,i,r){if(n.tagName.toLowerCase()!=="select")throw new Error("groupedOptions binding applies only to SELECT elements");for(var u=window;n.firstChild;)u.ko.removeNode(n.firstChild);return u.ko.utils.registerEventHandler(n,"change",function(){var t=u.ko.utils.domData.get(n,"property"),i,f;typeof t!="undefined"&&(i=u.ko.utils.arrayFirst(n.getElementsByTagName("option"),function(n){return n.selected===!0||n.getAttribute("selected")}),i!==null)&&(f=u.ko.utils.domData.get(i,"data"),typeof t=="function"?t(f):typeof t=="string"&&(r[t]=f))}),{controlsDescendantBindings:!0}},update:function(n,t,i,r){var u=window,c=u.document,e=u.ko.unwrap(t()),f=e.groups,b,ft="Label",k="Options",d="Text",g="Value",et=function(){var t=document&&function(){for(var n=3,t=document.createElement("div"),i=t.getElementsByTagName("i");t.innerHTML="<!--[if gt IE "+ ++n+"]><i><\/i><![endif]-->",i[0];);return n>4?n:undefined}(),n=function(n){while(n.firstChild)u.ko.removeNode(n.firstChild)},i=function(t,i){if(n(t),i)for(var r=0,u=i.length;r<u;r++)t.appendChild(i[r])},r=function(n,i){t<7?n.setAttribute("selected",i):n.selected=i};return{emptyDomNode:n,setDomNodeChildren:i,setOptionNodeSelectionState:r}}(),nt=function(n,t){return typeof n=="string"&&n.length?n:t},l,o,ot,a,v,y,s,st,h,p,ut;if(typeof f!="undefined"&&f)b=f.coll;else throw'The "groupedOption" binding requires a "groups" object be specified.';if(!b)throw'The "groupedOption" binding\'s "groups" object requires that a collection (array or observableArray) be specified.';for(typeof f.label=="string"&&f.label.length&&(ft=f.label),typeof f.options=="object"&&(l=f.options,k=nt(l.coll,k),d=nt(l.text,d),g=nt(l.value,g)),o=e.value,ot=u.ko.unwrap(o),typeof o=="function"?u.ko.utils.domData.set(n,"property",o):typeof o=="string"&&u.ko.utils.domData.set(n,"property",o),u.ko.utils.domData.set(n,"data",r),a=c.createDocumentFragment(),e.optionsCaption&&typeof e.optionsCaption=="string"&&e.optionsCaption.length&&(v=c.createElement("option"),v.innerHTML=e.optionsCaption,v.setAttribute("value",""),a.appendChild(v)),y=u.ko.utils.unwrapObservable(b),s=0,st=y.length;s<st;s++){var ht=u.ko.unwrap(y[s]),ct=u.ko.unwrap(y[s][k]),lt=ct.length,tt=u.ko.unwrap(ht[ft]);if(tt&&tt.length){for(h=c.createElement("optgroup"),h.setAttribute("label",tt),u.ko.utils.domData.set(h,"data",ht),p=0;p<lt;p++){var it=ct[p],at=u.ko.unwrap(it[d]),rt=u.ko.unwrap(it[g]),w=c.createElement("option");w.innerHTML=at;rt&&rt.length&&w.setAttribute("value",rt);u.ko.utils.domData.set(w,"data",it);h.appendChild(w)}a.appendChild(h)}}return et.emptyDomNode(n),n.appendChild(a),ut=u.ko.utils.arrayFirst(n.getElementsByTagName("option"),function(n){return u.ko.utils.domData.get(n,"data")===ot}),ut&&et.setOptionNodeSelectionState(ut,!0),!0}};
